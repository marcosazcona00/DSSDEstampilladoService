import { JsonFetcher } from "./https.js";
import { JwtHeader, JwtPayload } from "./jwt-model.js";
import { Json, JsonObject } from "./safe-json-parse.js";
interface DecomposedJwt {
    header: JwtHeader;
    payload: JwtPayload;
}
interface JwkFields {
    alg: "RS256" | string;
    kid: string;
    kty: string;
    use: string;
    n: string;
    e: string;
    [key: string]: unknown;
}
export declare type Jwk = JwkFields & JsonObject;
interface JwksFields {
    keys: readonly Jwk[];
}
export declare type Jwks = JwksFields & JsonObject;
export interface JwksCache {
    getJwk(jwksUri: string, decomposedJwt: DecomposedJwt): Promise<Jwk>;
    getCachedJwk(jwksUri: string, decomposedJwt: DecomposedJwt): Jwk;
    addJwks(jwksUri: string, jwks: Jwks): void;
    getJwks(jwksUri: string): Promise<Jwks>;
}
export declare function fetchJwks(jwksUri: string): Promise<Jwks>;
export declare function fetchJwk(jwksUri: string, decomposedJwt: DecomposedJwt): Promise<Jwk>;
export declare function assertIsJwks(jwks: Json): asserts jwks is Jwks;
export declare function assertIsJwk(jwk: Json): asserts jwk is Jwk;
export declare function isJwks(jwks: Json): jwks is Jwks;
export declare function isJwk(jwk: Json): jwk is Jwk;
export interface PenaltyBox {
    wait: (jwksUri: string, kid: string) => Promise<void>;
    release: (jwksUri: string, kid?: string) => void;
    registerFailedAttempt: (jwksUri: string, kid: string) => void;
    registerSuccessfulAttempt: (jwksUri: string, kid: string) => void;
}
export declare class SimplePenaltyBox implements PenaltyBox {
    waitSeconds: number;
    private waitingUris;
    constructor(props?: {
        waitSeconds?: number;
    });
    wait(jwksUri: string): Promise<void>;
    release(jwksUri: string): void;
    registerFailedAttempt(jwksUri: string): void;
    registerSuccessfulAttempt(jwksUri: string): void;
}
export declare class SimpleJwksCache implements JwksCache {
    fetcher: JsonFetcher;
    penaltyBox: PenaltyBox;
    private jwksCache;
    private fetchingJwks;
    constructor(props?: {
        penaltyBox?: PenaltyBox;
        fetcher?: JsonFetcher;
    });
    addJwks(jwksUri: string, jwks: Jwks): void;
    getJwks(jwksUri: string): Promise<Jwks>;
    getCachedJwk(jwksUri: string, decomposedJwt: DecomposedJwt): Jwk;
    getJwk(jwksUri: string, decomposedJwt: DecomposedJwt): Promise<Jwk>;
}
export {};
